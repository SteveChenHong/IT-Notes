# Windows `netstat` 指令使用說明

`netstat` 指令可用於查看本機網路與外部網路之間的連線狀況。您可以透過這些指令來查詢是否有異常連線，並檢視您的電腦網路連線狀況。

## 1. 基本命令

### 查詢所有連線狀態
在命令提示字元或 PowerShell 輸入以下命令：

```powershell
C:\WINDOWS\system32>netstat -ano
````

### 狀態說明：

* **LISTENING**：偵聽狀態，等待外部連接。
* **ESTABLISHED**：連線已建立，兩台設備正在通信。
* **CLOSE\_WAIT**：對方主動關閉連線或網路異常，這時本機狀態為 CLOSE\_WAIT，應呼叫 `close()` 正常關閉。
* **TIME\_WAIT**：本機主動關閉連線，等待對方確認關閉。
* **SYN\_SENT**：連線初始化時，發送 SYN 封包以開始連接。
* **SYN\_RECV**：接收到要求連線的 SYN 封包。
* **FIN\_WAIT1**：服務器端已中斷連線，正在斷開中。
* **FIN\_WAIT2**：連線已關閉，正在等待對方確認斷線。

### 顯示範例：

| 協定  | 本機位址                | 外部位址              | 狀態          | PID   |
| --- | ------------------- | ----------------- | ----------- | ----- |
| TCP | 192.168.0.100:50867 | 140.82.114.25:443 | ESTABLISHED | 10224 |

這表示本機的端口 `50867` 已經與 `140.82.114.25:443` 連線成功，PID 為 `10224`。

> **注意**：可以透過「工作管理員」 -> 「詳細資料」頁籤查詢處理程序的 PID。

## 2. 顯示命令詳細參數說明

```powershell
C:\WINDOWS\system32>netstat /?
```

### 參數說明：

* **-a**：顯示所有連線與偵聽中的端口。
* **-b**：顯示每個連線或偵聽端口對應的可執行檔。
* **-n**：以數字格式顯示位址與端口號碼。
* **-o**：顯示與每個連線對應的進程識別碼 (PID)。
* **-p proto**：顯示指定協定（如 TCP、UDP、TCPv6、UDPv6）的連線統計。

例如，若使用 `-p` 參數，可以指定某一個協定：

```powershell
C:\WINDOWS\system32>netstat -p tcp
```

這會顯示所有 TCP 連線。

## 3. 其他實用用法

### 篩選特定 IP 或端口

您可以使用 `find` 命令過濾 `netstat` 輸出的結果，查詢特定的 IP 或端口。以下是幾個範例：

* 查詢特定 IP 的連線：

  ```powershell
  netstat -na | find "192.168.0.100"
  ```

* 查詢特定端口的連線：

  ```powershell
  netstat -na | find "5353"
  ```

* 查詢特定 IP 和端口的連線：

  ```powershell
  netstat -na | find "192.168.0.100:5353"
  ```

* 每秒更新一次顯示特定 IP 的連線：

  ```powershell
  netstat -na 1 | find "192.168.0.100"
  ```

* 查詢特定端口並篩選出已建立的連線：

  ```powershell
  netstat -na 1 | find "4444" | find "ESTABLISHED"
  ```

### 顯示特定連線的進程 PID

如果您希望查看觸發某個連線的進程 PID，您可以加上 `-o` 參數，並使用 `tasklist` 查詢對應的進程名稱：

```powershell
netstat -nao 1 | find "192.168.0.100"
```

這將顯示與特定 IP 相關的所有連線及其 PID。您可以根據 PID 使用 `tasklist` 查詢對應的進程名稱。

```powershell
tasklist /fi "PID eq 10224"
```

### 只列出 IPv4 監聽端口

```powershell
netstat -a -p tcp | find "7218"
```

這將顯示只有 IPv4 地址的監聽端口。

### 計算特定端口的連線數量

```powershell
netstat -a | find /c "7218"
```

這會顯示與 `7218` 端口相關的連線數量。

---

### 小技巧

* `netstat` 指令適合用來監控和排查網路連線問題，您可以定期執行此命令來檢查系統的網路連線狀況。
* 透過 `find` 過濾特定 IP 或端口，可以更高效地監控疑似異常的連線。
* 如果您發現可疑連線，使用 PID 來對應進程，並在 `工作管理員` 中進行進一步分析。

---

這些指令將幫助您更好地管理和監控 Windows 系統中的網路連線，避免不正常的連線或潛在的安全風險。

```
```
